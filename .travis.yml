os: linux
dist: xenial
language: shell
services:
  - docker
branches:
  only:
    - master
env:
  global:
    - IMAGE_NAME="danielchoi158/portfolio-frontend"
    - secure: TwOhNRRQKY/x1GpDJLiatJx7ZtoLbyEtpNRwVzSDKQlsRYjYCG1hw0sTkJ0WnbfVRRh/fJDStk/kCfwIwxzEWUcblQYnd/csa7LGopQY3Fz1NFjA5Kaz1Qimv9qGwmxBXWQBE5qYQjWEyqfoxcVmv97SkgDYZDGekoViSE5PJnd7dOA6DXFHnwqpQ7I4zqmXXMU3pb2Ygv/pUq2yr+mhloMyDSsPodBLqWxn2vIG3dlL/iWlbqKnU+P0CtJx9qQfv91NMS+gDIUDI+sP02VL4o89U9LYbromaBZR1myWbZ4Na+2jMem0hHjz1Kp/IC+1uOuSNQRr/5xwqi0aF9aNHZog4vmGSfe1pclq5t6+ZlShhO204iJ4PTcBo7PpfCTU0OwEEAOrYj7xEym5BWABz2ci3MlzqOqn2kJVACtHTKaglkYdoOiEEIvIQhrOObi5u37tLuCdf9g0n60tLMqF8hgQfxQkhfVWAa8w+GcjgDvXG2aBrvSvzxrN9ugCw2dNtI2TVf5V6lTQPg6HogecEfhSJoDXAxzAon22zxyKf/suiBhULXK3fintLjMqID5fsJfvPoAvhLHOTtPHm0EWo8OOcoaPRP0vBui3I8DIYft5BaV/AlVy2YYeXWlJ956AyzJjDpSUIp0pmEhs8B1RZmSsudclpMd45LKECUAUI2s=
    - secure: loaE3jtYR+W+r+WAm+2aHoGFHYqf3VtVIpx/drpeTC4VShJsfhR5xVTuImKI+XABDKnaNRDkVyUjcr1jSCQupk8xU+TIzkC31+HyDbhg+RGPVGEmDxVciWlKKhcjLCvACyOv3z7VdIec93bAVaNiAS6SWmNkQI0oO5dcJqm9laacHuKTvNGtHgMtgVXJbFWbjlujRdMTxFpk3oyhgyLV8jwPDOWJOaY8+qm69QVy1TYXTXk2OvGabA9TiszeNxv4ZPR86P0oa352JrsBmiv6yiYq8uGIzgXl2jwV+2axILqcj9iKQVayxGz7cLbxYkx9jxS4GCcpdlOQt8mrisgEMWU/lrjxOa73ywRB6VwOEGZPbQtceJCTnws6BgpYtWZeCrcflkTIn/7lm4a6vQCgP6exaEyd8UgAb6g8JE+yIPqZbFqeX2ZUJWshMh0Cbna1hgH2zW15BrvBtYye3sb4k6/1pDoHd55H0bRR22XyrI1HVLnU5pG6jWR07jpYhUu1UCFlVPV9Q0+q3fPbfVXj8+lqDYOcNaLqwK9b0A0MOfAyBkA757T18XWpEYTCIz+9pVO2b6ERyL/+/g9fRZA073A/+IHHVXE0RAc3Ns6q/zaQCmqSR0qrU1gr2ip2eYAtaOl4X0BKxVW1MwEGmYJTkCslUwpwbi/ziDQ1/A5kWM4=
before_script:
  - cd frontend/
  - docker pull "$IMAGE_NAME" || true
script:
  - docker build --pull --cache-from "$IMAGE_NAME" --tag "$IMAGE_NAME" .
after_script:
  - docker images
before_deploy:
  - docker login -u $REGISTRY_USER -p $REGISTRY_PASSWORD
  - docker tag "$IMAGE_NAME" "${IMAGE_NAME}:latest"
deploy:
  provider: script
  script: docker push "${IMAGE_NAME}:latest" && docker push "${IMAGE_NAME}:${version}"
  on:
    branch: master
